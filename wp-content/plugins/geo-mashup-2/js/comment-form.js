jQuery(function(f){var d=f("#comment"),j=f("#geo-mashup-summary-input"),i=f("#geo-mashup-summary-label"),c=f("#geo-mashup-busy-icon"),k=f("#geo-mashup-lat-input"),g=f("#geo-mashup-lng-input");var h=false;var e=function(m){if(m.postalCodes.length>0){j.val(m.postalCodes[0].placeName+", "+m.postalCodes[0].adminName1)}};var b=function(n){var m="http://api.geonames.org/findNearbyPostalCodesJSON?maxRows=1&callback=?&username="+geo_mashup_comment_form_settings.geonames_username;k.val(n.lat);g.val(n.lng);c.hide();j.show().val("");f.getJSON(m,n,e);h=false};var a=function(m){c.hide();if(m.totalResultsCount===0){j.val("")}else{k.val(m.geonames[0].lat);g.val(m.geonames[0].lng);j.val(m.geonames[0].name+", "+m.geonames[0].adminName1)}h=false};var l=function(){var m="http://api.geonames.org/searchJSON?maxRows=1&callback=?&username="+geo_mashup_comment_form_settings.geonames_username;var n={q:j.val()};if(h){k.val("");g.val("");c.show();f.getJSON(m,n,a)}};f("#submit").before(i).before(c).before(j);d.change(function(){if(i.is(":visible")){return}i.show();c.show();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(n){b({lat:n.coords.latitude,lng:n.coords.longitude})},function(){c.hide();j.show()})}else{if(google&&google.gears){var m=google.gears.factory.create("beta.geolocation");m.getCurrentPosition(function(n){b({lat:n.latitude,lng:n.longitude})},function(){c.hide();j.show()})}}});j.focus(function(){j.select()});j.change(l);j.keypress(function(m){if((m.keyCode&&m.keyCode===13)||(m.which&&m.which===13)){l();return false}else{h=true;return true}})});