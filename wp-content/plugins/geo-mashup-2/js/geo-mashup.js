var GeoMashup,customizeGeoMashup,customizeGeoMashupMap,customGeoMashupColorIcon,customGeoMashupCategoryIcon,customGeoMashupSinglePostIcon,customGeoMashupMultiplePostImage;GeoMashup={actions:{},objects:{},object_count:0,locations:{},categories:{},category_count:0,open_attachments:[],errors:[],color_names:["red","lime","blue","orange","yellow","aqua","green","silver","maroon","olive","navy","purple","gray","teal","fuchsia","white","black"],colors:{red:"#ff071e",lime:"#62d962",blue:"#9595ff",orange:"#fe8f00",yellow:"#f2f261",aqua:"#8eeff0",green:"#459234",silver:"#c2c2c2",maroon:"#ae1a40",olive:"#9f9b46",navy:"#30389d",purple:"#a54086",gray:"#9b9b9b",teal:"#13957b",fuchsia:"#e550e5",white:"#ffffff",black:"#000000"},firstLoad:true,clone:function(b){var a=function(){};a.prototype=b;return new a()},forEach:function(b,c){var a;for(a in b){if(b.hasOwnProperty(a)&&typeof b[a]!=="function"){c.apply(this,[a,b[a]])}}},locationCache:function(b,a){if(!this.locations.hasOwnProperty(b)){return false}if(!this.locations[b].cache){this.locations[b].cache={}}if(!this.locations[b].cache.hasOwnProperty(a)){this.locations[b].cache[a]={}}return this.locations[b].cache[a]},addAction:function(a,b){if(typeof b!=="function"){return false}if(typeof this.actions[a]!=="object"){this.actions[a]=[b]}else{this.actions[a].push(b)}return true},doAction:function(b){var a,c;if(typeof this.actions[b]!=="object"){return false}a=Array.prototype.slice.apply(arguments,[1]);for(c=0;c<this.actions[b].length;c+=1){if(typeof this.actions[b][c]==="function"){this.actions[b][c].apply(null,a)}}return true},parentScrollToGeoPost:function(){var a;if(this.have_parent_access){a=parent.document.getElementById("gm-post");if(a){parent.focus();parent.scrollTo(a.offsetLeft,a.offsetTop)}}return false},buildCategoryHierarchy:function(c){var b,a,d,e;if(c){c=c.toString();b={};a=0;for(e in this.opts.category_opts){if(this.opts.category_opts.hasOwnProperty(e)&&this.opts.category_opts[e].parent_id&&this.opts.category_opts[e].parent_id===c){b[e]=this.buildCategoryHierarchy(e);a+=1}}return(a>0)?b:null}else{this.category_hierarchy={};for(d in this.opts.category_opts){if(this.opts.category_opts.hasOwnProperty(d)&&!this.opts.category_opts[d].parent_id){this.category_hierarchy[d]=this.buildCategoryHierarchy(d)}}}},isCategoryAncestor:function(b,a){b=b.toString();a=a.toString();if(this.opts.category_opts[a].parent_id){if(this.opts.category_opts[a].parent_id===b){return true}else{return this.isCategoryAncestor(b,this.opts.category_opts[a].parent_id)}}else{return false}},hasLocatedChildren:function(b,a){var c;if(this.categories[b]){return true}for(c in a){if(a.hasOwnProperty(c)&&this.hasLocatedChildren(c,a[c])){return true}}return false},searchCategoryHierarchy:function(b,c){var a,d;if(!c){c=this.category_hierarchy}for(d in c){if(c.hasOwnProperty(d)&&typeof c[d]!=="function"){if(d===b){return c[d]}else{if(c[d]){a=this.searchCategoryHierarchy(b,c[d]);if(a){return a}}}}}return null},hideCategoryHierarchy:function(a){var b;this.hideCategory(a);this.forEach(this.tab_hierarchy[a],function(c){this.hideCategoryHierarchy(c)})},showCategoryHierarchy:function(a){var b;this.showCategory(a);this.forEach(this.tab_hierarchy[a],function(c){this.showCategoryHierarchy(c)})},categoryTabSelect:function(e){var c,f,b,a,h,d,g;if(!this.have_parent_access){return false}f=parent.document.getElementById(this.opts.name+"-tab-index");if(!f){return false}b=f.childNodes[0];for(c=0;c<b.childNodes.length;c+=1){a=b.childNodes[c];h=a.childNodes[0].href.match(/\d+$/);d=h&&h[0];if(d===e){a.className="gm-tab-active gm-tab-active-"+e}else{a.className="gm-tab-inactive gm-tab-inactive-"+d}}this.forEach(this.tab_hierarchy,function(i){g=parent.document.getElementById(this.categoryIndexId(i));if(g){if(i===e){g.className="gm-tabs-panel"}else{g.className="gm-tabs-panel gm-hidden";if(!this.opts.show_inactive_tab_markers){this.hideCategoryHierarchy(i)}}}});if(!this.opts.show_inactive_tab_markers){this.showCategoryHierarchy(e)}},categoryIndexId:function(a){return"gm-cat-index-"+a},categoryTabIndexHtml:function(b){var a=[],c;a.push('<div id="');a.push(this.opts.name);a.push('-tab-index"><ul class="gm-tabs-nav">');for(c in b){if(b.hasOwnProperty(c)&&this.hasLocatedChildren(c,b[c])){a=a.concat(['<li class="gm-tab-inactive gm-tab-inactive-',c,'"><a href="#',this.categoryIndexId(c),'" onclick="frames[\'',this.opts.name,"'].GeoMashup.categoryTabSelect('",c,"'); return false;\">"]);if(this.categories[c]){a.push('<img src="');a.push(this.categories[c].icon.image);a.push('" />')}a.push("<span>");a.push(this.opts.category_opts[c].name);a.push("</span></a></li>")}}a.push("</ul></div>");this.forEach(b,function(d){a.push(this.categoryIndexHtml(d,b[d]))});return a.join("")},categoryIndexHtml:function(b,c,e){var g,h,k,j=[],d,f,a;if(typeof e==="undefined"){e=true}j.push('<div id="');j.push(this.categoryIndexId(b));j.push('" class="gm-tabs-panel');if(e){j.push(" gm-hidden")}j.push('"><ul class="gm-index-posts">');if(this.categories[b]){this.categories[b].posts.sort(function(l,i){h=GeoMashup.objects[l].title;k=GeoMashup.objects[i].title;if(h===k){return 0}else{return h<k?-1:1}});for(g=0;g<this.categories[b].posts.length;g+=1){j.push("<li>");j.push(this.objectLinkHtml(this.categories[b].posts[g]));j.push("</li>")}}j.push("</ul>");d=0;f='<ul class="gm-sub-cat-index">';j.push(f);this.forEach(c,function(i){j.push("<li>");if(this.categories[i]){j.push('<img src="');j.push(this.categories[i].icon.image);j.push('" />');j.push('<span class="gm-sub-cat-title">');j.push(this.opts.category_opts[i].name);j.push("</span>")}j.push(this.categoryIndexHtml(i,c[i],false));j.push("</li>");d+=1;if(this.opts.tab_index_group_size&&d%this.opts.tab_index_group_size===0){j.push("</ul>");j.push(f)}});j.push("</ul></div>");return j.join("")},createCategoryLine:function(a){},showCategoryInfo:function(){var a=null,e,d,h,i,g,f,b,c;if(this.opts.name&&this.have_parent_access){a=parent.document.getElementById(this.opts.name+"-legend")}if(!a&&this.have_parent_access){a=parent.document.getElementById("gm-cat-legend")}if(this.opts.legend_format&&"dl"===this.opts.legend_format){i="dl";g="";f="dt";b="dd"}else{i="table";g="tr";f="td";b="td"}e=["<",i,' class="gm-legend">'];this.forEach(this.categories,function(k,j){this.createCategoryLine(j);if(a){if(typeof this.opts.interactive_legend==="undefined"){this.opts.interactive_legend=true}if(this.opts.name&&this.opts.interactive_legend){c="gm-cat-checkbox-"+k;h=['<label for="',c,'"><input type="checkbox" name="category_checkbox" id="',c,'" onclick="if (this.checked) { frames[\'',this.opts.name,"'].GeoMashup.showCategory('",k,"'); } else { frames['",this.opts.name,"'].GeoMashup.hideCategory('",k,'\'); }" checked="true" />',this.opts.category_opts[k].name,"</label>"].join("")}else{h=this.opts.category_opts[k].name}if(g){e.push("<"+g+">")}e=e.concat(["<",f,'><img src="',j.icon.image,'" alt="',k,'"></',f,"><",b,">",h,"</",b,">"]);if(g){e.push("</"+g+">")}}});e.push("</"+i+">");if(a){a.innerHTML=e.join("")}},initializeTabbedIndex:function(){var a,b;if(!this.have_parent_access){return false}b=parent.document.getElementById(this.opts.name+"-tabbed-index");if(!b){b=parent.document.getElementById("gm-tabbed-index")}if(b){if(this.opts.start_tab_category_id){this.tab_hierarchy=this.searchCategoryHierarchy(this.opts.start_tab_category_id)}else{this.tab_hierarchy=this.category_hierarchy}b.innerHTML=this.categoryTabIndexHtml(this.tab_hierarchy);if(!this.opts.disable_tab_auto_select){for(a in this.tab_hierarchy){if(this.tab_hierarchy.hasOwnProperty(a)&&typeof a!=="function"){if(this.hasLocatedChildren(a,this.tab_hierarchy[a])){this.categoryTabSelect(a);break}}}}}},getShowPostElement:function(){if(this.have_parent_access&&!this.show_post_element&&this.opts.name){this.show_post_element=parent.document.getElementById(this.opts.name+"-post")}if(this.have_parent_access&&!this.show_post_element){this.show_post_element=parent.document.getElementById("gm-post")}return this.show_post_element},parentizeLinksMarkup:function(b){var a=document.createElement("div");a.innerHTML=b;this.parentizeLinks(a);return a.innerHTML},parentizeLinks:function(c){var b,a=c.getElementsByTagName("a");if(parent){for(b=0;b<a.length;b+=1){if(a[b].target.length===0||a[b].target==="_self"){a[b].target="_parent"}}}},showLoadingIcon:function(){if(!this.spinner_div.parentNode){this.container.appendChild(this.spinner_div)}},hideLoadingIcon:function(){if(this.spinner_div.parentNode){this.spinner_div.parentNode.removeChild(this.spinner_div)}},getObjectsAtLocation:function(a){return this.locations[a].objects},getMarkerObjects:function(a){return this.getObjectsAtLocation(this.getMarkerLatLng(a))},getMarkerLatLng:function(a){},addGlowMarker:function(a){},openInfoWindow:function(a){},closeInfoWindow:function(a){},removeGlowMarker:function(){},hideAttachments:function(){},showMarkerAttachments:function(a){},loadFullPost:function(a){},selectMarker:function(b){var a=this.getMarkerLatLng(b);this.selected_marker=b;if(this.opts.marker_select_info_window){this.openInfoWindow(b)}if(this.opts.marker_select_attachments){this.showMarkerAttachments(b)}if(this.opts.marker_select_highlight){this.addGlowMarker(b)}if(this.opts.marker_select_center){this.centerMarker(b)}if("full-post"!==this.opts.template&&this.getShowPostElement()){this.loadFullPost(a)}this.doAction("selectedMarker",this.opts,this.selected_marker,this.map)},centerMarker:function(a,b){},deselectMarker:function(){var b,a=GeoMashup.getShowPostElement();if(a){a.innerHTML=""}if(this.glow_marker){this.removeGlowMarker()}if(this.selected_marker){this.closeInfoWindow(this.selected_marker)}this.hideAttachments();this.selected_marker=null},addObjectIcon:function(a){},createMarker:function(a,c){var b;return b},checkDependencies:function(){},clickObjectMarker:function(b,a){},clickMarker:function(b,a){this.clickObjectMarker(b,a)},getCategoryName:function(a){return this.category_opts[a].name},hideMarker:function(a){},showMarker:function(a){},hideLine:function(a){},showLine:function(a){},newLatLng:function(b,a){var c;return c},extendLocationBounds:function(){},addMarkers:function(){},makeMarkerMultiple:function(a){},setMarkerImage:function(a,b){},autoZoom:function(){},recluster:function(){},extendCategory:function(a,g,d){var e,c,b,f;if(!this.categories[g]){if(this.opts.category_opts[g].color_name){b=this.opts.category_opts[g].color_name}else{b=this.color_names[this.category_count%this.color_names.length]}c=this.colors[b];if(!e&&typeof customGeoMashupCategoryIcon==="function"){e=customGeoMashupCategoryIcon(this.opts,[g])}if(!e&&typeof customGeoMashupColorIcon==="function"){e=customGeoMashupColorIcon(this.opts,b)}if(!e){e=this.colorIcon(b)}this.doAction("categoryIcon",this.opts,e,g);this.doAction("colorIcon",this.opts,e,b);f=-1;if(this.opts.category_opts[g].max_line_zoom){f=this.opts.category_opts[g].max_line_zoom}this.categories[g]={icon:e,points:[a],posts:[d],color:c,visible:true,max_line_zoom:f};this.category_count+=1}else{this.categories[g].points.push(a);this.categories[g].posts.push(d)}},updateMarkerVisibilities:function(){this.forEach(this.locations,function(a,b){GeoMashup.updateMarkerVisibility(b.marker,a)});this.updateVisibleList()},updateMarkerVisibility:function(b,a){if(this.isMarkerOn(b)){this.showMarker(b)}else{this.hideMarker(b)}},isMarkerOn:function(a){var c,e,b=[],d={visible:false};e=this.getMarkerObjects(a);for(c=0;c<e.length;c+=1){if(this.isObjectOn(e[c])){d.visible=true;b.push(c)}}if(d.visible){if(e.length>1){if(b.length===1){this.setMarkerImage(a,e[b[0]].icon.image)}else{this.makeMarkerMultiple(a)}}else{if(e[0].categories.length>1){if(e[0].visible_categories.length===1){this.setMarkerImage(a,this.categories[e[0].visible_categories[0]].icon.image)}else{this.setMarkerImage(a,e[0].icon.image)}}}}this.doAction("markerVisibilityOptions",this.opts,d,a,this.map);return d.visible},isObjectOn:function(d){var b,a,c={visible:false};d.visible_categories=[];if(0===d.categories.length){c.visible=true}else{for(b=0;b<d.categories.length;b+=1){a=d.categories[b];if(this.categories[a]&&this.categories[a].visible){d.visible_categories.push(a);c.visible=true}}}this.doAction("objectVisibilityOptions",this.opts,c,d,this.map);return c.visible},getOnObjectIDs:function(c){var a,b=[];for(a=0;a<c.length;a+=1){if(this.isObjectOn(c[a])){b.push(c[a].object_id)}}return b},hideCategory:function(b){var a,c;if(!this.categories[b]){return false}if(this.map.closeInfoWindow){this.map.closeInfoWindow()}if(this.categories[b].line){this.hideLine(this.categories[b].line)}this.categories[b].visible=false;for(a=0;a<this.categories[b].points.length;a+=1){c=this.locations[this.categories[b].points[a]];this.updateMarkerVisibility(c.marker,this.categories[b].points[a])}this.recluster();this.updateVisibleList()},showCategory:function(c){var b,a;if(!this.categories[c]){return false}if(this.categories[c].line&&this.map.getZoom()<=this.categories[c].max_line_zoom){this.showLine(this.categories[c].line)}this.categories[c].visible=true;for(b=0;b<this.categories[c].points.length;b+=1){a=this.categories[c].points[b];this.updateMarkerVisibility(this.locations[a].marker,a)}this.recluster();this.updateVisibleList()},addObjects:function(h,b){var e,c,l,k,a,f,g,d=[];if(b){this.forEach(this.categories,function(j,i){i.points.length=0;if(i.line){this.hideLine(i.line)}})}for(e=0;e<h.length;e+=1){l=h[e].object_id;k=this.newLatLng(parseFloat(h[e].lat),parseFloat(h[e].lng));for(c=0;c<h[e].categories.length;c+=1){a=h[e].categories[c];this.extendCategory(k,a,l)}if(this.opts.max_posts&&this.object_count>=this.opts.max_posts){break}if(!this.objects[l]){this.objects[l]=h[e];this.object_count+=1;if(!this.locations[k]){this.extendLocationBounds(k);this.locations[k]={objects:[h[e]],loaded_content:{}};f=this.createMarker(k,h[e]);this.objects[l].marker=f;this.locations[k].marker=f;d.push(f)}else{this.locations[k].objects.push(h[e]);f=this.locations[k].marker;this.makeMarkerMultiple(f);this.objects[l].marker=f;this.addObjectIcon(this.objects[l])}}}if(b){this.showCategoryInfo()}this.addMarkers(d);this.initializeTabbedIndex();if(this.firstLoad){this.firstLoad=false;if(this.opts.auto_info_open&&this.object_count>0){if(!this.opts.open_object_id){if(this.opts.context_object_id&&this.objects[this.opts.context_object_id]){this.opts.open_object_id=this.opts.context_object_id}else{this.opts.open_object_id=h[0].object_id}}this.clickObjectMarker(this.opts.open_object_id)}if(this.opts.zoom==="auto"){this.autoZoom()}else{if(this.opts.context_object_id&&this.objects[this.opts.context_object_id]){this.centerMarker(this.objects[this.opts.context_object_id].marker,parseInt(this.opts.zoom,10))}this.updateVisibleList()}}},requestObjects:function(a){},hideMarkers:function(){var a;for(a in this.locations){if(this.locations.hasOwnProperty(a)&&this.locations[a].marker){this.hideMarker(this.locations[a].marker)}}this.recluster();this.updateVisibleList()},showMarkers:function(){var b,c,a;for(c in this.categories){if(this.categories.hasOwnProperty(c)&&this.categories[c].visible){for(b=0;b<this.categories[c].points.length;b+=1){a=this.categories[c].points[b];this.showMarker(this.locations[a].marker)}}}},adjustZoom:function(){var b,a,c;c=this.map.getZoom();if(typeof this.last_zoom_level==="undefined"){this.last_zoom_level=c}a=this.last_zoom_level;for(b in this.categories){if(this.categories.hasOwnProperty(b)){if(a<=this.categories[b].max_line_zoom&&c>this.categories[b].max_line_zoom){this.hideLine(this.categories[b].line)}else{if(this.categories[b].visible&&a>this.categories[b].max_line_zoom&&c<=this.categories[b].max_line_zoom){this.showLine(this.categories[b].line)}}}}if(this.clusterer&&"markercluster"===this.opts.cluster_lib){if(a<=this.opts.cluster_max_zoom&&c>this.opts.cluster_max_zoom){this.clusterer.clusteringEnabled=false;this.clusterer.refresh(true)}else{if(a>this.opts.cluster_max_zoom&&c<=this.opts.cluster_max_zoom){this.clusterer.clusteringEnabled=true;this.clusterer.refresh(true)}}}this.last_zoom_level=c},objectLinkHtml:function(a){return['<a href="#',this.opts.name,'" onclick="frames[\'',this.opts.name,"'].GeoMashup.clickObjectMarker(",a,');">',this.objects[a].title,"</a>"].join("")},isMarkerVisible:function(a){return false},updateVisibleList:function(){var d,c,a,b=0;if(this.have_parent_access&&this.opts.name){c=parent.document.getElementById(this.opts.name+"-visible-list-header");d=parent.document.getElementById(this.opts.name+"-visible-list")}if(c){c.style.display="block"}if(d){a=['<ul class="gm-visible-list">'];this.forEach(this.objects,function(f,e){if(this.isObjectOn(e)&&this.isMarkerVisible(e.marker)){a.push('<li><img src="');a.push(e.icon.image);a.push('" alt="');a.push(e.title);a.push('" />');a.push(this.objectLinkHtml(f));a.push("</li>");b+=1}});a.push("</ul>");d.innerHTML=a.join("");this.doAction("updatedVisibleList",this.opts,b)}},adjustViewport:function(){this.updateVisibleList()},createMap:function(a,b){}};