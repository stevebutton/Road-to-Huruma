GeoMashup.createCategoryLine=function(a){a.line=new google.maps.Polyline(a.points,a.color);google.maps.Event.addListener(a.line,"click",function(){GeoMashup.map.zoomIn()});this.doAction("categoryLine",this.opts,a.line);this.map.addOverlay(a.line);if(this.map.getZoom()>a.max_line_zoom){a.line.hide()}};GeoMashup.openMarkerInfoWindow=function(a,b,c){var d=a.getLatLng();this.doAction("markerInfoWindowOptions",this.opts,this.locations[d],c);a.openInfoWindow(b,c)};GeoMashup.loadMaxContent=function(b,a,f,d){var e=new google.maps.XmlHttp.create();var c={url:f};this.doAction("markerInfoWindowMaxRequest",b,c);e.open("GET",c.url,true);e.onreadystatechange=function(){var i,h,g;if(e.readyState===4&&e.status===200){g={content:e.responseText};GeoMashup.doAction("markerInfoWindowMaxLoad",b,g);i=document.createElement("div");i.innerHTML=g.content;GeoMashup.parentizeLinks(i);d.info_window_options={maxContent:i};GeoMashup.openMarkerInfoWindow(b,a,{maxContent:i})}};e.send(null)};GeoMashup.openInfoWindow=function(f){var c,b,a,e,j,d,h,g=f.getPoint();this.map.closeInfoWindow();c=this.getOnObjectIDs(this.getMarkerObjects(f));b="info-window-"+c.join(",");a=this.locationCache(g,b);if(a.info_node){f.openInfoWindow(a.info_node,a.info_window_options)}else{f.openInfoWindowHtml('<div align="center"><img src="'+this.opts.url_path+'/images/busy_icon.gif" alt="Loading..." /></div>');j={url:this.geo_query_url+"&object_name="+this.opts.object_name+"&object_ids="+c.join(",")};this.doAction("markerInfoWindowRequest",f,j);d=new google.maps.XmlHttp.create();d.open("GET",j.url,true);d.onreadystatechange=function(){var l,i,k;if(d.readyState===4&&d.status===200){k={content:d.responseText};GeoMashup.doAction("markerInfoWindowLoad",f,k);l=document.createElement("div");l.innerHTML=k.content;GeoMashup.parentizeLinks(l);a.info_node=l;if("post"===GeoMashup.opts.object_name){GeoMashup.loadMaxContent(f,l,j.url+"&template=info-window-max",a)}else{a.info_window_options={};GeoMashup.openMarkerInfoWindow(f,l,{});GeoMashup.doAction("loadedInfoWindow")}}};d.send(null)}};GeoMashup.addGlowMarker=function(b){var a;if(this.glow_marker){this.map.removeOverlay(this.glow_marker);this.glow_marker.setLatLng(b.getLatLng())}else{a=new google.maps.Icon({image:this.opts.url_path+"/images/mm_20_glow.png",iconSize:new google.maps.Size(22,30),iconAnchor:new google.maps.Point(11,27)});this.doAction("glowMarkerIcon",this.opts,a);this.glow_marker=new google.maps.Marker(b.getLatLng(),{clickable:false,icon:a})}this.map.addOverlay(this.glow_marker)};GeoMashup.removeGlowMarker=function(){this.map.removeOverlay(this.glow_marker)};GeoMashup.hideAttachments=function(){var b,a,c;for(b=0;b<this.open_attachments.length;b+=1){this.map.removeOverlay(this.open_attachments[b])}this.open_attachments=[]};GeoMashup.showMarkerAttachments=function(a){var b;this.hideAttachments();b=this.getObjectsAtLocation(a.getLatLng());this.forEach(b,function(d,e){var c={action:"geo_mashup_kml_attachments"};if(e.attachments){this.forEach(e.attachments,function(f,g){this.open_attachments.push(g);this.map.addOverlay(g)})}else{e.attachments=[];c.post_ids=e.object_id;jQuery.getJSON(this.opts.ajaxurl+"?callback=?",c,function(f){GeoMashup.forEach(f,function(h,g){var i=new google.maps.GeoXml(g);e.attachments.push(i);this.open_attachments.push(i);this.map.addOverlay(i)})})}})};GeoMashup.loadFullPost=function(a){var f,e,d,c,h,g,b;h=this.getObjectsAtLocation(a);g=this.getOnObjectIDs(h);d=this.locationCache(a,"full-post-"+g.join(","));if(d.post_html){this.getShowPostElement().innerHTML=d.post_html}else{this.getShowPostElement().innerHTML='<div align="center"><img src="'+this.opts.url_path+'/images/busy_icon.gif" alt="Loading..." /></div>';b={url:this.geo_query_url+"&object_name="+this.opts.object_name+"&object_ids="+g.join(",")+"&template=full-post"};this.doAction("fullPostRequest",h,b);c=new google.maps.XmlHttp.create();c.open("GET",b.url,true);c.onreadystatechange=function(){var i;if(c.readyState===4&&c.status===200){i={content:c.responseText};GeoMashup.doAction("fullPostLoad",h,i);GeoMashup.getShowPostElement().innerHTML=i.content;GeoMashup.doAction("fullPostChanged");d.post_html=i.content}};c.send(null)}};GeoMashup.addObjectIcon=function(a){if(typeof customGeoMashupCategoryIcon==="function"){a.icon=customGeoMashupCategoryIcon(this.opts,a.categories)}if(!a.icon){if(a.categories.length>1){a.icon=new google.maps.Icon(this.multiple_category_icon)}else{if(a.categories.length===1){a.icon=new google.maps.Icon(this.categories[a.categories[0]].icon)}else{a.icon=new google.maps.Icon(this.base_color_icon);a.icon.image=this.opts.url_path+"/images/mm_20_red.png"}}this.doAction("objectIcon",this.opts,a)}};GeoMashup.createMarker=function(a,d){var b,c={title:d.title.replace("&amp;","&")};if(!d.icon){this.addObjectIcon(d)}c.icon=this.clone(d.icon);this.doAction("objectMarkerOptions",this.opts,c,d);b=new google.maps.Marker(a,c);google.maps.Event.addListener(b,"click",function(){GeoMashup.selectMarker(b)});google.maps.Event.addListener(b,"remove",function(){if(GeoMashup.selected_marker&&b===GeoMashup.selected_marker){GeoMashup.deselectMarker()}});google.maps.Event.addListener(b,"visibilitychanged",function(e){if(GeoMashup.selected_marker&&b===GeoMashup.selected_marker&&!e){GeoMashup.deselectMarker()}});this.doAction("marker",this.opts,b);return b};GeoMashup.checkDependencies=function(){if(typeof google.maps.Map==="undefined"||!google.maps.BrowserIsCompatible()){this.container.innerHTML='<p class="errormessage">Sorry, the Google Maps script failed to load. Have you entered your <a href="http://maps.google.com/apis/maps/signup.html">API key</a> in the Geo Mashup Options?';throw"The Google Maps javascript didn't load."}};GeoMashup.clickObjectMarker=function(b,a){if(typeof a==="undefined"){a=1}if(this.objects[b]&&a<4){if(GeoMashup.objects[b].marker.isHidden()){a+=1;setTimeout(function(){GeoMashup.clickObjectMarker(b,a)},300)}else{google.maps.Event.trigger(GeoMashup.objects[b].marker,"click")}}};GeoMashup.colorIcon=function(a){var b=new google.maps.Icon(this.base_color_icon);b.image=this.opts.url_path+"/images/mm_20_"+a+".png";return b};GeoMashup.getMarkerLatLng=function(a){return a.getLatLng()};GeoMashup.hideMarker=function(a){if(a===this.selected_marker){this.deselectMarker()}a.hide()};GeoMashup.showMarker=function(a){a.show()};GeoMashup.hideLine=function(a){a.hide()};GeoMashup.showLine=function(a){a.show()};GeoMashup.newLatLng=function(b,a){return new google.maps.LatLng(b,a)};GeoMashup.extendLocationBounds=function(a){this.location_bounds.extend(a)};GeoMashup.addMarkers=function(a){if((!this.clusterer)||"clustermarker"===this.opts.cluster_lib){this.forEach(a,function(c,b){this.map.addOverlay(b)})}if(this.clusterer&&a.length>0){this.clusterer.addMarkers(a);this.recluster()}};GeoMashup.makeMarkerMultiple=function(a){var b;if(typeof customGeoMashupMultiplePostImage==="function"){b=customGeoMashupMultiplePostImage(this.opts,a.getIcon().image)}if(!b){b=this.opts.url_path+"/images/mm_20_plus.png"}if(a.getIcon().image!==b){a.setImage(b);a.getIcon().image=b}this.doAction("multiObjectMarker",this.opts,a);this.doAction("multiObjectIcon",this.opts,a.getIcon())};GeoMashup.setMarkerImage=function(a,b){if(a.getIcon().image!==b){a.setImage(b);a.getIcon().image=b}};GeoMashup.setCenterUpToMaxZoom=function(d,b,c){var a=this.map.getCurrentMapType();if(a===google.maps.SATELLITE_MAP||a===google.maps.HYBRID_MAP){a.getMaxZoomAtLatLng(d,function(e){if(e&&e.status===google.maps.GEO_SUCCESS){if(e.zoom<b){b=e.zoom}}GeoMashup.map.setCenter(d,b);if(typeof c==="function"){c(b)}},b)}else{if(a.getMaximumResolution()<b){b=a.getMaximumResolution()}this.map.setCenter(d,b);if(typeof c==="function"){c(b)}}};GeoMashup.autoZoom=function(){var a=this.map.getBoundsZoomLevel(this.location_bounds);var b=parseInt(this.opts.auto_zoom_max,10);if(a>b){a=b}this.setCenterUpToMaxZoom(this.location_bounds.getCenter(),a,function(){GeoMashup.updateVisibleList()})};GeoMashup.centerMarker=function(a,b){if(typeof b==="number"){this.map.setCenter(a.getLatLng(),b)}else{this.map.panTo(a.getLatLng())}};GeoMashup.requestObjects=function(b){var e,c,a,d;if(this.opts.max_posts&&this.object_count>=this.opts.max_posts){return}e=google.maps.XmlHttp.create();c=this.geo_query_url;if(b){a=this.map.getBounds();d=a.toSpan();c+="&minlat="+(a.getSouthWest().lat()-d.lat())+"&minlon="+(a.getSouthWest().lng()-d.lng())+"&maxlat="+(a.getSouthWest().lat()+3*d.lat())+"&maxlon="+(a.getSouthWest().lng()+3*d.lat())}if(this.opts.map_cat){c+="&cat="+GeoMashup.opts.map_cat}if(this.opts.max_posts){c+="&limit="+GeoMashup.opts.max_posts}e.open("GET",c,true);e.onreadystatechange=function(){var f;if(e.readyState===4&&e.status===200){f=window["eval"]("("+e.responseText+")");GeoMashup.addObjects(f,!b)}};e.send(null)};GeoMashup.isMarkerVisible=function(b){var a=this.map.getBounds();return(!b.isHidden()&&a.containsLatLng(b.getLatLng()))};GeoMashup.recluster=function(){if(this.clusterer){if("clustermarker"===this.opts.cluster_lib){this.clusterer.refresh()}else{this.clusterer.resetViewport()}}};GeoMashup.createMap=function(h,k){var p,m,o,b,d,c,e,a,l,u,j,n,q,f,s,t=1,g={};this.container=h;this.checkDependencies();this.base_color_icon=new google.maps.Icon();this.base_color_icon.image=k.url_path+"/images/mm_20_black.png";this.base_color_icon.shadow=k.url_path+"/images/mm_20_shadow.png";this.base_color_icon.iconSize=new google.maps.Size(12,20);this.base_color_icon.shadowSize=new google.maps.Size(22,20);this.base_color_icon.iconAnchor=new google.maps.Point(6,20);this.base_color_icon.infoWindowAnchor=new google.maps.Point(5,1);this.multiple_category_icon=new google.maps.Icon(this.base_color_icon);this.multiple_category_icon.image=k.url_path+"/images/mm_20_mixed.png";this.forEach(k,function(i,v){if("false"===v||"FALSE"===v){k[i]=false}});this.have_parent_access=false;try{if(typeof parent==="object"){parent.document.getElementById("bogus-test");this.have_parent_access=true}}catch(r){}k.home_url=k.siteurl;d={G_NORMAL_MAP:google.maps.NORMAL_MAP,G_SATELLITE_MAP:google.maps.SATELLITE_MAP,G_HYBRID_MAP:google.maps.HYBRID_MAP,G_PHYSICAL_MAP:google.maps.PHYSICAL_MAP,G_SATELLITE_3D_MAP:google.maps.SATELLITE_3D_MAP};if(typeof k.map_type==="string"){if(d[k.map_type]){k.map_type=d[k.map_type]}else{m=parseInt(k.map_type,10);if(isNaN(m)){k.map_type=google.maps.NORMAL_MAP}else{k.map_type=this.map.getMapTypes()[m]}}}else{if(typeof k.map_type==="undefined"){k.map_type=google.maps.NORMAL_MAP}}b={backgroundColor:"#"+k.background_color,mapTypes:[k.map_type],googleBarOptions:{adsOptions:{client:k.adsense_code||"pub-5088093001880917"}}};this.doAction("mapOptions",k,b);this.map=new google.maps.Map2(this.container,b);this.map.setCenter(new google.maps.LatLng(0,0),0);this.doAction("newMap",k,this.map);this.spinner_div=document.createElement("div");this.spinner_div.innerHTML='<div id="gm-loading-icon" style="-moz-user-select: none; z-index: 100; position: absolute; left: '+(this.map.getSize().width/2)+"px; top: "+(this.map.getSize().height/2)+'px;"><img style="border: 0px none ; margin: 0px; padding: 0px; width: 16px; height: 16px; -moz-user-select: none;" src="'+k.url_path+'/images/busy_icon.gif"/></a></div>';this.showLoadingIcon();google.maps.Event.bind(this.map,"tilesloaded",this,this.hideLoadingIcon);if(!k.object_name){k.object_name="post"}this.opts=k;g.url=k.siteurl+"/?geo_mashup_content=geo-query&map_name="+encodeURIComponent(k.name);if(k.lang){g.url+="&lang="+encodeURIComponent(k.lang)}this.doAction("geoQueryUrl",this.opts,g);this.geo_query_url=g.url;google.maps.Event.bind(this.map,"zoomend",this,this.adjustZoom);google.maps.Event.bind(this.map,"moveend",this,this.adjustViewport);if(k.cluster_max_zoom){if("clustermarker"===k.cluster_lib){j={iconOptions:{},fitMapMaxZoom:k.cluster_max_zoom,clusterMarkerTitle:"%count",intersectPadding:3};this.doAction("clusterOptions",this.opts,j);this.clusterer=new ClusterMarker(this.map,j)}else{j={maxZoom:parseInt(k.cluster_max_zoom,10)};this.doAction("clusterOptions",this.opts,j);this.clusterer=new MarkerClusterer(this.map,[],j)}}if(k.zoom!=="auto"&&typeof k.zoom==="string"){t=parseInt(k.zoom,10)}else{t=k.zoom}if(k.load_kml){this.kml=new google.maps.GeoXml(k.load_kml);this.map.addOverlay(this.kml);if(t==="auto"){this.kml.gotoDefaultViewport(this.map)}}this.buildCategoryHierarchy();if(t!=="auto"){if(k.center_lat&&k.center_lng){this.map.setCenter(new google.maps.LatLng(k.center_lat,k.center_lng),t,k.map_type)}else{if(this.kml){this.map.setCenter(this.kml.getDefaultCenter,t,k.map_type)}else{if(k.object_data&&k.object_data.objects[0]){o=new google.maps.LatLng(k.object_data.objects[0].lat,k.object_data.objects[0].lng);this.map.setCenter(o,t,k.map_type)}else{c=google.maps.XmlHttp.create();e=this.geo_query_url+"&limit=1";if(k.map_cat){e+="&cat="+k.map_cat}c.open("GET",e,false);c.send(null);a=window["eval"]("("+c.responseText+")");if(a.length>0){l=new google.maps.LatLng(a[0].lat,a[0].lng);this.map.setCenter(l,t,k.map_type)}else{this.map.setCenter(new google.maps.LatLng(0,0),t,k.map_type)}}}}}this.location_bounds=new google.maps.LatLngBounds();if(k.map_content==="single"){if(k.object_data&&k.object_data.objects.length&&!this.kml){u={};if(typeof customGeoMashupSinglePostIcon==="function"){u.icon=customGeoMashupSinglePostIcon(this.opts)}if(!u.icon){u.icon=G_DEFAULT_ICON}this.doAction("singleMarkerOptions",this.opts,u);q=new google.maps.Marker(new google.maps.LatLng(k.object_data.objects[0].lat,k.object_data.objects[0].lng),u);this.map.addOverlay(q);this.doAction("singleMarker",this.opts,q)}}else{if(k.object_data){this.addObjects(k.object_data.objects,true)}else{this.requestObjects(true);this.requestObjects(false)}}if("GSmallZoomControl"===k.map_control){this.map.addControl(new google.maps.SmallZoomControl())}else{if("GSmallZoomControl3D"===k.map_control){this.map.addControl(new google.maps.SmallZoomControl3D())}else{if("GSmallMapControl"===k.map_control){this.map.addControl(new google.maps.SmallMapControl())}else{if("GLargeMapControl"===k.map_control){this.map.addControl(new google.maps.LargeMapControl())}else{if("GLargeMapControl3D"===k.map_control){this.map.addControl(new google.maps.LargeMapControl3D())}}}}}if(k.add_map_type_control){if(typeof k.add_map_type_control==="string"){k.add_map_type_control=k.add_map_type_control.split(/\s*,\s*/);if(typeof d[k.add_map_type_control[0]]==="undefined"){k.add_map_type_control=["G_NORMAL_MAP","G_SATELLITE_MAP","G_PHYSICAL_MAP"]}}for(p=0;p<k.add_map_type_control.length;p+=1){this.map.addMapType(d[k.add_map_type_control[p]])}this.map.addControl(new google.maps.MapTypeControl())}if(k.add_overview_control){this.overview_control=new google.maps.OverviewMapControl();this.overview_control.setMapType(k.map_type);this.doAction("overviewControl",this.opts,this.overview_control);this.map.addControl(this.overview_control);f=document.getElementById("gm-overview");if(f){f.style.position="absolute";this.container.appendChild(f)}}if(k.add_google_bar){this.map.enableGoogleBar()}if(k.enable_scroll_wheel_zoom){this.map.enableScrollWheelZoom()}google.maps.Event.addListener(this.map,"click",function(i){if(GeoMashup.selected_marker&&(!i)){GeoMashup.deselectMarker()}});if(typeof customizeGeoMashupMap==="function"){customizeGeoMashupMap(this.opts,this.map)}if(typeof customizeGeoMashup==="function"){customizeGeoMashup(this)}this.doAction("loadedMap",this.opts,this.map)};